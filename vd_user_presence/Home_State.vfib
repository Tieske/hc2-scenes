{"name":"Home State","type":"virtual_device","properties":{"deviceIcon":0,"currentIcon":"1007","log":"","logTemp":"","mainLoop":"local HomeState --= fibaro:getGlobalValue(\"HomeState\")\nlocal ThisDevice = fibaro:getSelfId()\n\nwhile true do\n  local CurrentState = fibaro:getGlobalValue(\"HomeState\")\n  if CurrentState == HomeState then\n    -- nothing to do\n  else\n    -- update my icons\n    if CurrentState == \"Away\" then\n      fibaro:call(ThisDevice, \"pressButton\", \"3\")\n    elseif CurrentState == \"Home\" then\n      fibaro:call(ThisDevice, \"pressButton\", \"1\")\n    else \n      fibaro:call(ThisDevice, \"pressButton\", \"2\")\n    end\n\n    HomeState = CurrentState\n  end\n  fibaro:sleep(1000)\nend\n","visible":"true","rows":[{"type":"button","elements":[{"id":1,"lua":true,"waitForResponse":false,"caption":"Home","name":"Button11","empty":false,"msg":"local GlobalName = \"HomeState\"\n\n------------ Nothing to customize below ------------\n\nfibaro:setGlobal(GlobalName, \"Home\")\n","buttonIcon":1007,"favourite":false,"main":false},{"id":2,"lua":true,"waitForResponse":false,"caption":"Sleep","name":"Button12","empty":false,"msg":"local GlobalName = \"HomeState\"\n\n------------ Nothing to customize below ------------\n\nfibaro:setGlobal(GlobalName, \"Sleep\")\n","buttonIcon":1008,"favourite":false,"main":false},{"id":3,"lua":true,"waitForResponse":false,"caption":"Away","name":"Button13","empty":false,"msg":"local GlobalName = \"HomeState\"\n\n------------ Nothing to customize below ------------\n\nfibaro:setGlobal(GlobalName, \"Away\")\n","buttonIcon":1009,"favourite":false,"main":false}]},{"type":"button","elements":[{"id":4,"lua":true,"waitForResponse":false,"caption":"Toggle","name":"Button21","empty":false,"msg":"local GlobalName = \"HomeState\"\n\n------------ Nothing to customize below ------------\n\nlocal Status = fibaro:getGlobalValue(GlobalName)\nlocal ThisDevice = fibaro:getSelfId()\n\nif Status == \"Away\" then\n  fibaro:call(ThisDevice, \"pressButton\", \"1\")\nelseif Status == \"Home\" then\n  fibaro:call(ThisDevice, \"pressButton\", \"2\")\nelse \n  fibaro:call(ThisDevice, \"pressButton\", \"3\")\nend\n","buttonIcon":1007,"favourite":false,"main":true}]}]},"actions":{"pressButton":1,"setSlider":2,"setProperty":2}}